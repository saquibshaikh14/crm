<p class="lead mb-3">Welcome <%= user.name %></p>
<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheets/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <title>Customer</title>
</head>

<body>

    <nav class="navbar shadow navbar-expand-lg navbar-dark bg-dark fixed-top" style="font-weight: 500;">
        <div class="container">
          <a class="navbar-brand" href="/">
            Logo
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>
          <div id="navbarNavDropdown" class="navbar-collapse collapse">
              <ul class="navbar-nav mr-auto">
                  <li class="nav-item active">
                      <a class="nav-link" href="/">Audience </a>
                  </li>
                  <li class="nav-item">
                      <a class="nav-link" href="#">About</a>
                  </li>
                 
  
              </ul>
              <ul class="navbar-nav">
                
                <li class="nav-item">
                    <a class="nav-link" href="#"><%= user.name.split(" ")[0] %></a>
                </li>
                  <li class="nav-item">
                      <a class="nav-link" href="/users/logout">Logout</a>
                  </li>
                 
                  
              </ul>
          </div>
                  
        </div>
      </nav>



    <!-- audience section -->
    <div style="width: 100%;height:15px"></div>
    <% if(success_msg=='Updated successfully'){ %>
    <div class="alert alert-success text-center" id="fade-out"><%= success_msg %></div>
    <% } %>
    <div class="main">
    

        <div class="row mt-4 mt-md-3 u-row-border">

            <nav class="navbar navbar-light w-100 py-0">

                <div id="navbarNavAltMarkup">
                    <div class="navbar-nav">
                        <a class="nav-item ml-4 ml-sm-0 px-1 nav-link active" href="/customer">All contacts
                        </a>
                        
                            <a class="btn u-bordered-btn left-aligned-btn" href="/addCustomer"><span class="fa fa-plus"></span> Add contacts</a>
                        
                    </div>
                </div>
            </nav>
        </div>

   

        <div class="row mt-3 mt-md-5">
            <div class="col-md-4 order-md-2 p-2">
                <div class="form-group m-0 p-0">
                    <input type="text" class="form-control pl-5" id="search-lead" placeholder="Search" id="search-lead">
                    <span class="fa fa-search search-icon"></span>
                </div>
            </div>
            <div class="col-md-8 order-md-1 p-2">
  

                <button class="btn u-bordered-btn dropdown-toggle shadow-none" type="button" id="create-segment" aria-haspopup="true" aria-expanded="false">
                    Create segment
                </button>
            <div class="create-segment-container">
                <div class="form-group mt-2 p-2">
                    <input class="form-control shadow-none search-segment" type="text" placeholder="Search segment">
                </div>
                <div id="segments">
                    <div class="dropdown-header pl-2">BY PROPERTIES</div>

                    <button class="dropdown-item segment-item prop" type="button">Date added</button>
                    <button class="dropdown-item segment-item prop" type="button">Email</button>
                    <button class="dropdown-item segment-item prop" type="button">First name</button>
                    <button class="dropdown-item segment-item prop" type="button">Last name</button>
                    <!-- <button class="dropdown-item segment-item prop" type="button">Gender</button> -->
                    <button class="dropdown-item segment-item prop" type="button">Date of birth</button>
                    <button class="dropdown-item segment-item prop" type="button">Contact</button>
                    <button class="dropdown-item segment-item prop" type="button">City</button>
                    <button class="dropdown-item segment-item prop" type="button">State</button>
                    <button class="dropdown-item segment-item prop" type="button">Country</button>
                    <button class="dropdown-item segment-item prop" type="button">Zip</button>
                    <button class="dropdown-item segment-item prop" type="button">Tag</button>
                    <div class="dropdown-divider"></div>

                    <div class="dropdown-header pl-2">BY SHOPPING</div>
                    <button class="dropdown-item segment-item shop" type="button">Product</button>
                    <button class="dropdown-item segment-item shop" type="button">Order date</button>  

                    <div class="dropdown-divider"></div>
                    <div class="dropdown-header pl-2">BY SUBSCRIPTION</div>
                    <button class="dropdown-item segment-item sub" type="button">EMAIL</button>
                    <button class="dropdown-item segment-item sub" type="button">SMS</button>


                    <div class="dropdown-divider"></div>
                </div>


            </div>
            <div class="new-segment">
                <div class="mt-2">
                    <button type="button" class="btn ml-3 shadow-none filter-back" style="border-radius: 50%;border: 1px solid gray;color: #6a6467;"><span class="fa fa-chevron-left"></span></button>
                    <span style="margin-left: 20px;color: gray;"></span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="new-segment-content clearfix">
                    <!--                    contetn will be here.-->
                </div>

            </div>


                
            </div>

        </div>

        <div class="row mt-5">
            <div class="table-responsive lead-table">
                <table class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Name</th>
                            <th scope="col">Email</th>
                            <th scope="col">Contact</th>
                            <th scope="col">Joined</th>
                            <th scope="col">Address</th>
                            <th scope="col"></th>
                        </tr>
                    </thead>
                    <tbody>
                        <% for(var i=0;i<customers.length;i++){ %>
                        <tr>
                            <th scope="row"><%= i+1 %></th>
							<td><a href="#"><%= customers[i].firstName +' '+ customers[i].lastName%></a></td>
                            <td><%= customers[i].email %></td>
                            <td><%= customers[i].mobile %></td>
                            <td><%= new Date(customers[i].dateAdded).toJSON().slice(0,10) %></td>
                            <td><%= customers[i].address %></td>
                            <td>
                                <a class="btn btn-primary btn-sm shadow-none" href="/customer/contact/edit/<%= customers[i]._id %>">Edit</a>
                            </td>
                        </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
            <!-- table ends -->
        </div>

    </div>







    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
            //search segment
            $('.search-segment').on('keyup', function() {
                var seg = $(this).val().toLocaleLowerCase();
                $('#segments *').filter(function() {
                    $(this).toggle($(this).text().toLocaleLowerCase().indexOf(seg) > -1)
                });
            });
            //search in table.
            $('#search-lead').on('keyup', function() {
                var lead = $(this).val().toLocaleLowerCase();
                $('.lead-table tbody tr').filter(function() {
                    $(this).toggle($(this).text().toLocaleLowerCase().indexOf(lead) > -1);
                });
            });
            //back button
            $('.filter-back').on('click', function() {
                $('.new-segment').hide();
                $('.create-segment-container').show();
            });
            //segment fropdown
            $('#create-segment').on('click', function() {
                //$('.create-segment-container').toggle();
                $('.new-segment').hide();
                $(this).next().toggle();
            });
            //segment form generation
            $('.segment-item').on('click', function(){
                $('.create-segment-container').hide();
                $('.new-segment').show();
                var heading = $(this).text();
                var content = '';
                if(['Date added', 'Date of birth', 'Order date'].includes(heading)){
                    $('.new-segment div > span').text(heading);
                    content = `
                        <form method="GET" action="/customer/segment" id="segment-form">
                            <input type="hidden" value="${heading.replace(/ +/g, '_')}" name="method">
                            <div class="form-group px-3">
                                <label>From date</label>
                                <input type="date" class="form-control" name="dinit" autocomplete="off">
                            </div>
                            <div class="form-group px-3">
                                <label>To date</label>
                                <input type="date" class="form-control" name="dfinal" autocomplete="off"> 
                            </div>
                            <button class="btn float-right btn-primary mt-2 mb-3 mr-4 submit-fliter">Submit</button>
                        </form>
                    `;
                }else if(['Email', 'First name', 'Last name', 'Contact', 'City', 'State', 'Country', 'Zip', 'Tag', 'Product'].includes(heading)){
                    $('.new-segment div > span').text(heading);
                    content = `
                        <form method="GET" action="/customer/segment" id="segment-form">
                            <input type="hidden" value="${heading.replace(/ +/g, '_')}" name="method">
                            <div class="form-group px-3">
                                <label>Segment by ${heading.toLowerCase()}</label>
                                <input type="text" class="form-control" name="val" autocomplete="off" placeholder="Enter ${heading.toLowerCase()}"> 
                            </div>
                            <button class="btn float-right btn-primary mt-2 mb-3 mr-4 submit-filter">Submit</button>
                        </form>
                    `;

                }else if(['EMAIL', 'SMS'].includes(heading)){
                    $('.new-segment div > span').text(heading);
                    content = `
                        <form method="GET" action="/customer/segment" id="segment-form">
                            <input type="hidden" value="${heading.replace(/ +/g, '_')}_sub" name="method">
                            <div class="form-group px-4 mt-3">
                                <label>${$(this).text()} marketing consent</label>
                                <select class="form-control mt-3" name="val">
                                    <option value="yes">Yes</option>
                                    <option value="no">No</option>
                                </select>
                            </div>
                            <button class="btn float-right btn-primary mt-2 mb-3 mr-4 submit-fliter">Submit</button>
                        </form>
                    `;
                }else{
                    $('.new-segment div > span').text("");
                    content="";
                }
                $('.new-segment-content').html(content);
                
            });
            
            //dismiss update success message
            $('#fade-out').fadeOut(3000);
        
        });

        
    </script>
</body>

</html>
